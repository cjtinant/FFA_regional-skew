---
title: "00_refactor_log"
author: "CJ Tinant"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---
title: "00_refactor_log â€“ File & Folder Reorganization Notes"
author: "Charles Jason Tinant"
date: "`r Sys.Date()`"
output: html_document
---

# Overview

This document tracks the **project structure refactor** for the Great
Plains Regional Skew Estimation project. The reorganization improves
clarity, modularity, and reproducibility by aligning files with
milestone workflows and standard naming conventions.

## Goals of Refactor

-   Clarify distinction between raw, processed, and derived spatial data

-   Move and modularize R scripts into milestone-based folders

-   Consolidate utility functions into a reusable location

-   Standardize naming and improve long-term maintainability

\_ Prepare for poster/reporting and model evaluation stages

------------------------------------------------------------------------

# Project structure

## Original project structure

``` text
    FFA_regional-skew/
    â”œâ”€â”€ arcgis_project/    # ArcGIS files
    â”œâ”€â”€ data/
    â”‚   â”œâ”€â”€ raw/           # Raw downloads (PRISM, USGS, etc.)
    â”‚   â”œâ”€â”€ clean/         # Cleaned covariate & skew datasets
    â”‚   â”œâ”€â”€ meta/          # # Metadata for reproducibility
    â”‚   â””â”€â”€ spatial/       # Spatial data for ecoregions (EPA)
    â”œâ”€â”€ figures/           # Plots and heatmaps
    â”œâ”€â”€ functions/         # Reusable R functions
    â”œâ”€â”€ references_pdfs/   # Background readings
    â”œâ”€â”€ model_summaries/   # CSVs of model coefficients, VIFs, etc.
    â”œâ”€â”€ results/           # Rmd files from prior EDA
    â”œâ”€â”€ scripts/           # Modular R scripts by milestone
    â”œâ”€â”€ README.Rmd         # Workflow overview (editable)
    â”œâ”€â”€ README.md          # Rendered Markdown output
    â””â”€â”€ .gitignore         # Prevents sensitive/local files from being pushed
```

## Updated File Structure

``` text
FFA_regional-skew/
â”œâ”€â”€ .gitignore                     # Prevents sensitive/local files from being pushed
â”œâ”€â”€ FFA_regional-skew.Rproj       # RStudio project file
â”œâ”€â”€ README.Rmd                    # Workflow overview (editable)
â”œâ”€â”€ README.md                     # Rendered Markdown output

â”œâ”€â”€ docs/                   # For flowcharts, planning diagrams, milestone logs
â”œâ”€â”€ notebooks/              # For ad hoc .Rmd or .qmd experiments
â”œâ”€â”€ log/                    # For shell logs or targets progress reports 

â”œâ”€â”€ R/                            # All analysis scripts (milestone-organized)
â”‚   â”œâ”€â”€ 01_download/              # NWIS, PRISM, Ecoregions
â”‚   â”œâ”€â”€ 02_clean/                 # Filtering, QA, station skew
â”‚   â”œâ”€â”€ 03_covariates/            # Climate, topography, land cover
â”‚   â”œâ”€â”€ 04_modeling/              # GAMs, Elastic Net, correlation
â”‚   â”œâ”€â”€ 05_eval/                  # Model diagnostics, residuals, validation
â”‚   â””â”€â”€ utils/                    # Reusable functions
â”‚       â””â”€â”€ f_process_geometries.R

â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                      # Unmodified input data
â”‚   â”‚   â”œâ”€â”€ elevation_ned.tif
â”‚   â”‚   â”œâ”€â”€ sites_all_in_bb.csv
â”‚   â”‚   â”œâ”€â”€ sites_all_peak_in_bb.csv
â”‚   â”‚   â”œâ”€â”€ raster_raw/          # PRISM rasters
â”‚   â”‚   â””â”€â”€ vector_raw/          # Shapefiles (unprojected/unprocessed)
â”‚   â”‚       â”œâ”€â”€ ecoregions_orig/
â”‚   â”‚       â”œâ”€â”€ ecoregions_unprojected/
â”‚   â”‚       â”œâ”€â”€ koppen-climate-classification/
â”‚   â”‚       â”œâ”€â”€ us_eco_lev01/ through us_eco_lev04/
â”‚   â”‚       â””â”€â”€ misc shapefiles/
â”‚   â”œâ”€â”€ processed/               # Cleaned, derived datasets
â”‚   â”‚   â”œâ”€â”€ spatial/             # Ready-to-use shapefiles and rasters
â”‚   â”‚   â”‚   â”œâ”€â”€ us_eco_lev01/
â”‚   â”‚   â”‚   â”œâ”€â”€ us_eco_lev02/
â”‚   â”‚   â”‚   â”œâ”€â”€ us_eco_lev03/
â”‚   â”‚   â”‚   â”œâ”€â”€ us_eco_lev04/
â”‚   â”‚   â”‚   â”œâ”€â”€ koppen_climate/
â”‚   â”‚   â”‚   â”œâ”€â”€ tl_state_boundaries/
â”‚   â”‚   â”‚   â””â”€â”€ derived_products/
â”‚   â””â”€â”€ meta/                    # CRS info, variable scaffold, project metadata
â”‚       â””â”€â”€ variable_scaffold.csv

â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ figs/                    # Plots and maps
â”‚   â”œâ”€â”€ models/                  # Model objects (.rds)
â”‚   â””â”€â”€ tables/                  # Summary tables (.csv, .html)

â”œâ”€â”€ results/                     # Manuscript-ready outputs, model metrics, final figures

â”œâ”€â”€ reports/
â”‚   â”œâ”€â”€ README.Rmd               # Project structure and data flow
â”‚   â”œâ”€â”€ posterdown/              # Poster files and assets
â”‚   â””â”€â”€ slides/                  # Slide decks or visualizations

â”œâ”€â”€ to_check/                    # Temporary holding area for uncertain or transitional files

```

# Migration Checklist

| Step | Task                                                          | Status |
|--------------|-------------------------------------------------------|-------|
| 1    | Soft archive old files                                        | [X]   |
| 2    | Create folders for each milestone step                        | [X]   |
| 3    | Move functions/ to R/utils/ and source with source()          | [X]   |
| 4    | Rename scripts/ to R/ and split by milestone function         | [X]   |
| 5    | Move raw shapefiles to data/raw/spatial_raw/                  | [X]   |
| 6    | Move cleaned shapefiles (projected, reclassified) to spatial/ | [X]   |
| 7    | Get Reference links                                           | []     |
| 8    | Create README-style notes for each R milestone folder         | []     |
| 9    | Document changes in README.Rmd                                | []     |
| 10   | Tag this commit in Git as v0.1-structure-refactor             | []     |

```{=html}
<!--


add a data_dictionary.csv in data/meta/

Add a log_README.md in each R/ subfolder to document script purpose

Consider a targets-based workflow if your scripts are getting complex

    Use both .Rmd and .md for documentation (ğŸ‘).

Inside that same folder, you can later add:

    00_refactor_checklist.csv (if you want a CSV to track renaming/moves)

    00_folder_before.png and 00_folder_after.png (for visuals)

    rename_scripts.R (if you want to learn R-side file management too)

-->
```

# Step-by-Step Refactor Log

## Step 01 - Soft Archive Old Files

-   **Action:** Move unverified/legacy files to to_check/ or delete/
    with caution.

-   **Before:** data/meta/variable_scaffold.csv

-   **Reason:** Improves clarity, modularity, and reproducibility of
    workflow.

-   **Before:** Unorganized files that may or may not be aligned with
    current project workflow.

-   **After:** Cleaner directory structure.

```{bash archive_unsorted, eval=FALSE}

cd ~/Documents/Rprojects_not-class/FFA_regional-skew/

pwd

# Move messy and not-yet-reviewed files into a holding area
#   a "to_check" folder instead of deleting them right away.
mkdir -p to_check

# move the contents of notebooks/ into to_check/.
mv notebooks/* to_check/

# Only delete the notebooks/ folder if it exists AND is empty
[ -d notebooks ] && [ -z "$(ls -A notebooks)" ] && rmdir notebooks

# move the contents of docs/ into to_check/.
mv docs/* to_check/

# Only delete the notebooks/ folder if it exists AND is empty
[ -d docs ] && [ -z "$(ls -A docs)" ] && rmdir docs

# move the contents of references_pdfs/ into to_check/.
mv references_pdfs/* to_check/

# Only delete the references_pdfs/ folder if it exists AND is empty
[ -d references_pdfs ] && [ -z "$(ls -A references_pdfs)" ] && rmdir references_pdfs


```

## Step 02 â€” Create files for each milestone step

-   **Reason:** Improves clarity, modularity, and reproducibility of
    workflow.

-   **Before:** Files partially aligned with milestone workflows. Ad hoc
    naming convention.

-   **After:** Separate raw/, clean/, meta/, functions/, and output/.
    Spatial data organized and modularized.

```{bash create_milestone_dirs, eval=FALSE}
# Create folders for each milestone step.
# The -p option makes sure parent folders are created if they don't exist,
# and it won't throw an error if the folder already exists.

mkdir -p R/00_project_structure_refactor        # Tracks project refactor
mkdir -p R/01_download        # Scripts for downloading data (e.g., NWIS, PRISM)
mkdir -p R/02_clean           # Scripts for cleaning raw data
mkdir -p R/03_covariates      # Scripts for processing climate/topo/land cover
mkdir -p R/04_exploratory     # Scripts for fitting models
mkdir -p R/05_modeling        # Scripts for fitting models
mkdir -p R/06_eval            # Scripts for evaluating models
mkdir -p R/utils              # Reusable functions

```

## Step 03 Move Functions into a Unified utils/ Folder

-   **Reason:** Centralize and reuse processing functions.

-   **Before:** functions/f_process_geometries.R

-   **After:** R/utils/f_process_geometries.R

-   **Scripts affected:** Any sourcing functions/; update to
    source("R/utils/â€¦")

```{bash move_functions_to_utils, eval=FALSE}

mv functions/*.R R/utils/      # Move the files inside of functions/

rmdir functions/               # Remove functions/ if it's empty

```

## Step 04 â€” Split and Organize scripts/ into Milestone-Based Folders

-   **Reason:** Improves modularity and tracks workflow by purpose.

-   **Before:** All code in scripts/

-   **After:** R/utils/f_process_geometries.R

``` text
R/
â”œâ”€â”€ 01_download/
â”œâ”€â”€ 02_clean/
â”œâ”€â”€ 03_covariates/
â”œâ”€â”€ 04_modeling/
â”œâ”€â”€ 05_eval/
```

-   **Scripts affected:** All main workflow scripts.

```{bash move_download_scripts_to_01_download, eval=FALSE}

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/01_get-spatial-data.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/01_download/01_get_spatial_data.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/02_get-gage-data.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/01_download/02_get_gage_data.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/07_download_climate_covariates.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/01_download/03_download_climate_covariates.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/08_download_terrain_covariates.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/01_download/04_download_terrain_covariates.R


```

```{bash move_clean_scripts_to_02_clean, eval=FALSE}

# Make sure the destination exists
mkdir -p R/02_clean

# Move cleaning scripts into milestone 02
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/03_filter_unregulated_gage_data.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/02_clean/05_filter_unregulated_gage_data.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/04_find_clean_export_site_summaries.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/02_clean/06_filter_unregulated_gage_data.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/05_update_problem_sites.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/02_clean/07_filter_unregulated_gage_data.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/06_calculate_station_skew.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/02_clean/08_filter_unregulated_gage_data.R

```

```{r move_clean_scripts_to_03_covariates, eval=FALSE}

# Ensure folders exist
mkdir -p R/03_covariates 

# Move covariate joiners
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/09_join_covariates_for_modeling.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/03_covariates/09_join_covariates_for_modeling.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/13_ecoregion_l2.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/03_covariates/13_ecoregion_l2.R

# Move explainer to check
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/09a_dont-run_join_covariates_explainer.R ~/Documents/Rprojects_not-class/FFA_regional-skew/to-check/09a_dont-run_join_covariates_explainer.R

```

```{r move_clean_scripts_to_04_exploratory eval=FALSE}

# Ensure folders exist
mkdir -p R/04_exploratory

# Move exploratory modeling
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/10a_exploratory_modeling_initial_checks.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/04_exploratory/10a_exploratory_modeling_initial_checks.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/10b_exploratory_modeling_correlation_reduction.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/04_exploratory/10b_exploratory_modeling_correlation_reduction.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/10c_exploratory_modeling_initial-models.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/04_exploratory/10c_exploratory_modeling_initial-models.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/10d_exploratory_modeling_variable_prep.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/04_exploratory/0d_exploratory_modeling_variable_prep.R 

```

```{r move_clean_scripts_to_05_modeling, eval=FALSE}

# Ensure folders exist
mkdir -p R/05_modeling

# Move exploratory modeling
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/11a_fit_enet_models.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/05_model/11a_fit_enet_models.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/11b_fit_gam_models.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/05_model/11b_fit_gam_models.R

```

```{r move_clean_scripts_to_06_eval, eval=FALSE}

# Ensure folders exist
mkdir -p R/06_eval

# Move exploratory modeling
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/11c_model_evaluation.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/06_eval/11c_model_evaluation.R
mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/12a_model_validation_and_prediction.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/06_eval/12a_model_validation_and_prediction.R

mv ~/Documents/Rprojects_not-class/FFA_regional-skew/scripts/12b_model_validation_and_prediction.R ~/Documents/Rprojects_not-class/FFA_regional-skew/R/06_eval/12b_model_validation_and_prediction.R


```

## Step 05 â€” Move Raw Spatial and Climate Data into data/raw/

-   **Reason:** Distinguish between raw inputs and processed outputs.

-   **Before:** data/spatial/ held both raw and derived data

-   **After:** R/utils/f_process_geometries.R

``` text
data/
â”œâ”€â”€ raw/
â”‚   â”œâ”€â”€ raster_raw/       # Ecoregions, Koppen, PHZM, etc.
â”‚   â”œâ”€â”€ vector_raw/
```

-   **Folders moved:** ecoregions, koppen-climate-classification, tl\_,
    us_eco

## Step 06â€” Promote Processed Spatial Layers to /spatial/

-   **Reason:** Maintain easy access to ready-to-use shapefiles.

-   **Before:** Mixed with raw

-   **After:** R/utils/f_process_geometries.R

```         
spatial/
â”œâ”€â”€ us_eco_lev01/
â”œâ”€â”€ us_eco_lev02/
â”œâ”€â”€ koppen_cleaned/
```

## Step 07 â€” Add data/meta/variable_scaffold.csv and README Tables

-   **Reason:** Track covariates by scale and origin.

-   **Before:** data/meta/variable_scaffold.csv

-   **After:** README.Rmd as knitr::kable()




## Step 08 Distinguish between exploratory output and final cleaned results.

-   **Reason:** Distinguish between exploratory output and final cleaned
    results.

-   **Before:** All tables in output/

-   **After:** Use results/ for cleaned output only.


# ğŸ—‚ï¸ Summary of Key Structural Changes

```         
Old Path | New Path | Change Type
functions/ | R/utils/ | relocate
scripts/ | R/01_download/ etc. | split + tag
data/spatial/ecoregions_* | data/raw/spatial_raw/ | move
us_eco_lev*/ | spatial/ | promote
README.Rmd (updated structure) |  | revise
```

# ğŸ§¾ Notes

-   Preserve original files in to_check/ if unsure

-   Consider backing up entire project before file moves

-   Update any hardcoded paths in scripts

# ğŸ”— References

# GE

-   Bespoke project organization for data science

-   Workflow principles in hydrology
